// Generated by CoffeeScript 1.6.3
(function() {
  var ARCHIVE_DOMAIN, MAX_POPUP, URL, g_interval, g_list, g_loading, g_popups, g_popups_index, g_window_height, g_window_width, g_z_index, init, loadList, resize, startPopup;

  URL = '/list';

  MAX_POPUP = 10;

  ARCHIVE_DOMAIN = 'http://web.archive.org';

  g_list = [];

  g_interval = null;

  g_popups = [];

  g_popups_index = 0;

  g_loading = true;

  g_z_index = 1;

  g_window_width = 0;

  g_window_height = 0;

  init = function() {
    var clone, element, i, parent, _i, _ref;
    resize();
    $(window).resize(resize);
    parent = $('#news');
    element = parent.find('li');
    g_popups.push(element);
    for (i = _i = 0, _ref = MAX_POPUP - 1; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
      clone = element.clone(true);
      g_popups.push(clone);
      clone.appendTo(parent);
    }
    loadList();
    return g_interval = setInterval(startPopup, 1500);
  };

  resize = function() {
    var w;
    w = $(window);
    g_window_width = w.width();
    return g_window_height = w.height();
  };

  loadList = function() {
    g_loading = true;
    return $.post(URL, {}, function(data) {
      g_loading = false;
      return g_list = g_list.concat(JSON.parse(data));
    });
  };

  startPopup = function() {
    var data, element, height, width, x, y;
    data = g_list.shift();
    element = g_popups[g_popups_index];
    element.find('a').attr('href', ARCHIVE_DOMAIN + data.key);
    element.find('.date').text(data.date);
    element.find('.title').text(data.title);
    width = element.outerWidth();
    height = element.outerHeight();
    x = Math.floor(Math.random() * (g_window_width - width));
    y = Math.floor(Math.random() * (g_window_height - height));
    element.css({
      'left': x,
      'top': y,
      'z-index': g_z_index
    });
    element.addClass('animation').delay(7000).queue(function(next) {
      $(this).removeClass('animation');
      return next();
    });
    g_z_index += 1;
    g_popups_index = (g_popups_index + 1) % MAX_POPUP;
    if (g_loading === false && g_list < 10) {
      return loadList();
    }
  };

  window.onload = function() {
    init();
    $('#social-button .twitter').socialbutton('twitter', {
      button: 'horizontal'
    });
    return $('#social-button .hatebu').socialbutton('hatena');
  };

}).call(this);
